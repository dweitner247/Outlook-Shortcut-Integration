<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Shortcut Add-in</title>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <script>
    Office.onReady(() => {
      // Office ist bereit ‚Äì keine Aktion n√∂tig
    });

    async function createShortcutStory(event) {
      try {
        const item = Office.context.mailbox.item;

        // Betreff und Body der Mail auslesen
        const subject = item.subject;
        const body = await getBodyAsync(item);

        // Shortcut API-Daten
        const shortcutToken = "b7a73287-ee90-4e31-9958-785a9ceeba52"; 
        const teamId = "68d27e9b-e00a-49a3-b440-e28b1cb7caa3";         
        const workflowStateId = 500000006;                            

        // Body vorbereiten
        const payload = {
          name: subject,
          description: body,
          team_id: teamId,
          workflow_state_id: workflowStateId
        };

        // Logging f√ºr Debug-Zwecke
        console.log("üì§ Shortcut Payload:", payload);

        // Request an Shortcut senden
        const response = await fetch("https://api.app.shortcut.com/api/v3/stories", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Shortcut-Token": shortcutToken
          },
          body: JSON.stringify(payload)
        });

        // Status und Antwort loggen
        console.log("üì° Shortcut Status:", response.status);
        const responseText = await response.text();
        console.log("üì¨ Shortcut Antwort:", responseText);

        // Erfolgsmeldung oder Fehler anzeigen
        if (response.ok) {
          Office.context.mailbox.item.notificationMessages.replaceAsync("status", {
            type: "informationalMessage",
            message: "‚úÖ Story wurde erfolgreich in Shortcut erstellt.",
            icon: "icon16",
            persistent: false
          });
        } else {
          throw new Error(`Fehler: ${response.status} - ${responseText}`);
        }

      } catch (error) {
        Office.context.mailbox.item.notificationMessages.replaceAsync("status", {
          type: "errorMessage",
          message: `‚ùå Fehler beim Erstellen: ${error.message}`,
          persistent: false
        });
        console.error("‚ùå Fehler beim Shortcut-Request:", error);
      } finally {
        event.completed();
      }
    }

    // Hilfsfunktion: E-Mail-Body abrufen
    function getBodyAsync(item) {
      return new Promise((resolve, reject) => {
        item.body.getAsync("text", result => {
          if (result.status === Office.AsyncResultStatus.Succeeded) {
            resolve(result.value);
          } else {
            reject(result.error);
          }
        });
      });
    }

    window.createShortcutStory = createShortcutStory;
  </script>
</head>
<body>
  <h1>Shortcut Integration l√§uft ‚úîÔ∏è (Debug-Modus)</h1>
</body>
</html>






